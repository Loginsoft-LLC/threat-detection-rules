title: Confluence Webshell activity on Windows
id: ed473006-e388-4c5d-8672-149c003e569b
description: Detection for Confluence activity through tomcat9.exe to run arbitrary commands
date: 16/06/2022
status: experimental
references: https://www.volexity.com/blog/2022/06/02/zero-day-exploitation-of-atlassian-confluence/
tags:
  -attack.t1033  #System Owner/User Discovery 
  -attack.t1018  #Remote System Discovery 
  -attack.t1218.011  #System Binary Proxy Execution: Rundll32 
  -attack.t1087.001 #Account Discovery: Local Account   
author: System-41
logsource:
  category: process_creation
  product: windows
detection:
  confluence_tomcat_binary:
    ParentImage|endswith:
      -'\Confluence\bin\tomcat9.exe'
  discovery:
    Image|endswith:
      -'\whoami.exe'
      -'\net.exe'
      -'\net1.exe'
      -'\schtasks.exe'
      -'\ping.exe'
      -'\ipconfig.exe'
      -'\vssadmin.exe'
      -'\tasklist.exe'
      -'\quser.exe'
      -'\hostname.exe'
      -'\systeminfo.exe'
  suspicious_proc:
    Image|endswith:
      -'\cmd.exe'
      -'\powershell.exe'
      -'\rundll32.exe'
      -'\fsutils.exe'
      -'\bitsadmin.exe'
  condition: confluence_tomcat_binary and (discovery or suspicious_proc)
falsepositives: unknown
level: high
